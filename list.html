{% include head.html %}

<section class="article pad-top">

      <article class="full-width">
        <header class="post-header">
          <hgroup>
            <h1>{{ page.title }}</h1>
            <p class="intro">{% if page.description %}{{ page.description }}{% else %}{{ page.tagline }}{% endif %}</p>
          </hgroup>
          <!-- put the search/filter bar here -->
        </header>
        <div id='users'>
            <div class="sort-buttons">
                <button class="sort" data-sort="title">Sort by title</button>
                <button class="sort" data-sort="date">Sort by date</button>
            </div>

            <div class="filter-buttons">
                <button id="clear-filter">clear</button>
                {% assign str = '' %}
                {% assign array = str | split:';' | sort %}
                {% capture keywords %}{% for post in site.categories[page.category] %}{% assign localarray = post.keywords | split:',' | sort %}{% for keyword in localarray %}{% unless array contains keyword %}{{ keyword }};{% capture keywordsstr %}{{ keywordsstr }};{{ keyword }}{% endcapture %}{% assign array = keywordsstr | split: ';' | sort %}{% endunless %}{% endfor %}{% endfor %}{% endcapture %}
                {% assign sortedkeywords = keywords | split: ';' | sort %}
                {% for keyword in sortedkeywords %}
                    <button class="filter">{{ keyword }}</button>
                {% endfor %}
            </div>
            <ul class='list grid'>
            {% if page.from_posts %}
              {% for post in site.categories[page.category] %}
              <li class="cell" href="../{{post.url}}" type="{{post.type}}" keywords="{{post.type}},{{post.keywords}}">
                <div class='title'>{% if post.long_title %}<div class='long-title'>{% endif %}{{post.title}}{% if post.long_title %}</div>{% endif %}</div>
                <div class='date'>{{ post.date }}</div>
                <div class='keywords'>{{ post.keywords }}</div>
              </li>
              {% endfor %}
            {% else %}
              {% for code in page.codes %}
              <a class="cell" href="../{{code.link}}" type="{{code.type}}" keywords="{{code.type}},{{code.keywords}}">
                <div class='title'>{{code.title}}</div>
              </a>
              {% endfor %}
            {% endif %}

            </ul>
        </div>
        <script src="{{ site.url }}/assets/list.js"></script>
        <script>
        var options = {
          valueNames: [ 'title', 'long-title', 'date', 'keywords' ]
        };

        var userList = new List('users', options);

        $('.filter').click(function() {
          string = $(this).text();
          userList.filter(function(item) {
            if (item.values().keywords.indexOf(string) != -1) {
              return true;
            } else {
              return false;
            }
          });
          return false;
        });
        $('#clear-filter').click(function() {
          userList.filter();
          return false;
        });
        </script>

      </article>
    </section>
</div>

{% include footer.html %}
